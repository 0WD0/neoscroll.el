#+TITLE: Neoscroll.el - Smooth Scrolling for Emacs
#+AUTHOR: Yuantao Wang
#+VERSION: 1.0.0

* Overview

Neoscroll provides smooth scrolling functionality for Emacs, inspired by [[https://github.com/karb94/neoscroll.nvim][neoscroll.nvim]]. It offers customizable easing functions, native compilation support for performance, and seamless integration with Evil mode.

* Features

- *Smooth Scrolling*: Multiple easing functions (linear, quadratic, cubic, sine)
- *High Performance*: Native compilation support and pixel-perfect scrolling
- *Evil Mode Integration*: Full compatibility with vim-style virtual column tracking
- *Responsive Input*: Intelligent interrupt handling prevents blocking
- *Customizable*: Adjustable scroll durations, line steps, and key mappings
- *Smart Key Bindings*: Respects insert mode and visual block selections
- *Auto Configuration*: Automatic pixel-scroll-precision-mode integration
- *Hook System*: Pre/post scroll hooks for custom functionality

* Installation

** Using straight.el

#+begin_src emacs-lisp
(straight-use-package '(neoscroll :type git :host github :repo "0WD0/neoscroll.el"))
#+end_src

** Using use-package with straight.el

#+begin_src emacs-lisp
(use-package neoscroll
  :straight (:type git :host github :repo "0WD0/neoscroll.el")
  :config
  (neoscroll-mode 1))
#+end_src

** Doom Emacs Configuration

Add to your ~packages.el~:

#+begin_src emacs-lisp
(package! neoscroll
  :recipe (:host github :repo "0WD0/neoscroll.el"))
#+end_src

Add to your ~config.el~:

#+begin_src emacs-lisp
(use-package! neoscroll
  :config
  ;; Configure smooth scrolling parameters
  (setq neoscroll-easing 'cubic)
  (setq neoscroll-scroll-duration 0.15)
  (setq neoscroll-page-duration 0.25) 
  (setq neoscroll-line-duration 0.025)
  (setq neoscroll-line-step 3)  ; Scroll 3 lines with C-y/C-e
  
  ;; Enable neoscroll mode
  (neoscroll-mode 1))
#+end_src

** Spacemacs Configuration

Add to your ~dotspacemacs-additional-packages~:

#+begin_src emacs-lisp
(neoscroll :location (recipe :fetcher github :repo "0WD0/neoscroll.el"))
#+end_src

Add to your ~dotspacemacs/user-config~:

#+begin_src emacs-lisp
(use-package neoscroll
  :config
  (setq neoscroll-easing 'cubic)
  (setq neoscroll-scroll-duration 0.15)
  (neoscroll-mode 1))
#+end_src

** Manual Installation

1. Clone the repository:
   #+begin_src shell
   git clone https://github.com/0WD0/neoscroll.el.git ~/.emacs.d/site-lisp/neoscroll
   #+end_src

2. Add to your init file:
   #+begin_src emacs-lisp
   (add-to-list 'load-path "~/.emacs.d/site-lisp/neoscroll")
   (require 'neoscroll)
   (neoscroll-mode 1)
   #+end_src

* Configuration

** Basic Setup

Enable neoscroll globally:

#+begin_src emacs-lisp
(require 'neoscroll)
(neoscroll-mode 1)
#+end_src

** Custom Configuration

#+begin_src emacs-lisp
(use-package neoscroll
  :config
  ;; Customize easing function
  (setq neoscroll-easing 'cubic)
  
  ;; Adjust scroll durations (in seconds)
  (setq neoscroll-scroll-duration 0.15)   ; C-u/C-d half-page scroll
  (setq neoscroll-page-duration 0.25)     ; C-f/C-b full-page scroll  
  (setq neoscroll-line-duration 0.025)    ; C-y/C-e line scroll
  
  ;; Customize line scrolling
  (setq neoscroll-line-step 3)            ; Scroll 3 lines with C-y/C-e
  
  ;; Customize key mappings (remove keys you don't want)
  (setq neoscroll-mappings '("C-u" "C-d" "C-f" "C-b" "C-y" "C-e"))
  
  ;; Add custom hooks
  (setq neoscroll-pre-hook
        (lambda (info) (message "Starting scroll: %s" info)))
  (setq neoscroll-post-hook
        (lambda (info) (message "Scroll complete: %s" info)))
  
  ;; Enable mode
  (neoscroll-mode 1))
#+end_src

** Minimal Configuration (Recommended)

For most users, this minimal setup provides excellent results:

#+begin_src emacs-lisp
(use-package neoscroll
  :config
  (setq neoscroll-easing 'cubic)
  (setq neoscroll-line-step 2)
  (neoscroll-mode 1))
#+end_src

** Advanced Setup with Custom Options

#+begin_src emacs-lisp
(neoscroll-setup '((easing . cubic)
                   (scroll-duration . 0.15)
                   (page-duration . 0.25)
                   (line-duration . 0.05)))
#+end_src

* Key Bindings

Default key mappings (automatically set up when enabling ~neoscroll-mode~):

| Key | Function         | Description           |
|-----+------------------+-----------------------|
| ~C-u~ | ~neoscroll-ctrl-u~ | Scroll up half page   |
| ~C-d~ | ~neoscroll-ctrl-d~ | Scroll down half page |
| ~C-b~ | ~neoscroll-ctrl-b~ | Scroll up full page   |
| ~C-f~ | ~neoscroll-ctrl-f~ | Scroll down full page |
| ~C-y~ | ~neoscroll-ctrl-y~ | Scroll up one line    |
| ~C-e~ | ~neoscroll-ctrl-e~ | Scroll down one line  |

** Evil Mode Integration

When Evil mode is detected, neoscroll automatically:
- **Replaces Evil's scroll commands** with smooth alternatives via advice system
- **Preserves vim-style virtual column tracking** during scrolling
- **Respects Evil states**: Only active in normal, visual, and motion states 
- **Maintains compatibility**: Works seamlessly with other Evil movement commands
- **Emergency stops**: Use ~C-g~ to interrupt animations
- **Smart interrupts**: Animations stop when other movement commands are used

The integration uses Evil's ~evil-ensure-column~ system to provide authentic vim behavior where the cursor maintains its "goal column" even when moving through lines of different lengths.

* Customization Options

** Variables

- ~neoscroll-easing~ :: Easing function (~linear~, ~quadratic~, ~cubic~, ~sine~)
- ~neoscroll-scroll-duration~ :: Duration for half-page scrolling (default: 0.15s)
- ~neoscroll-page-duration~ :: Duration for full-page scrolling (default: 0.25s) 
- ~neoscroll-line-duration~ :: Duration for line scrolling (default: 0.025s)
- ~neoscroll-line-step~ :: Number of lines to scroll with C-y/C-e (default: 1)
- ~neoscroll-mappings~ :: List of keys to bind (default: C-u, C-d, C-b, C-f, C-y, C-e)
- ~neoscroll-stop-eof~ :: Stop at end of file when scrolling down (default: t)
- ~neoscroll-pre-hook~ :: Function to run before scrolling starts
- ~neoscroll-post-hook~ :: Function to run after scrolling ends

** Easing Functions

Choose from different animation curves:

- ~linear~ :: Constant speed
- ~quadratic~ :: Accelerating motion  
- ~cubic~ :: Smooth acceleration and deceleration
- ~sine~ :: Sinusoidal easing

* API Reference

** Core Function

#+begin_src emacs-lisp
(neoscroll-scroll LINES &optional OPTS)
#+end_src

Scroll ~LINES~ with optional configuration ~OPTS~.

Options:
- ~:duration~ :: Animation duration in seconds
- ~:easing~ :: Easing function to use
- ~:move-cursor~ :: Whether to move cursor with scroll (default: t)
- ~:info~ :: Information passed to hooks

Example:
#+begin_src emacs-lisp
(neoscroll-scroll 10 '(:duration 0.3 :easing cubic :move-cursor nil))
#+end_src

** Predefined Commands

- ~neoscroll-ctrl-u~ :: Scroll up half page
- ~neoscroll-ctrl-d~ :: Scroll down half page
- ~neoscroll-ctrl-b~ :: Scroll up full page
- ~neoscroll-ctrl-f~ :: Scroll down full page
- ~neoscroll-ctrl-y~ :: Scroll up one line
- ~neoscroll-ctrl-e~ :: Scroll down one line

* Performance

- Uses native compilation when available for optimal performance
- Automatically enables ~pixel-scroll-precision-mode~ on graphical displays
- Intelligent time stepping based on easing functions
- Responsive interrupt handling prevents blocking

* Compatibility

- *Emacs Version*: 29.1+
- *Evil Mode*: Full integration and compatibility
- *Display*: Works on both graphical and terminal Emacs
- *Pixel Scrolling*: Automatically uses pixel-precise scrolling when available

* Troubleshooting

** Animation Not Smooth
- Ensure you're using a graphical Emacs session
- Check that ~pixel-scroll-precision-mode~ is available and enabled
- Try different easing functions

** Scrolling Interrupted
- This is by design for responsiveness
- Use ~C-g~ or ~<Escape>~ (in Evil mode) to stop animations
- Adjust durations if animations are too long

** Evil Mode Issues  
- Ensure Evil is loaded before neoscroll
- Check that key bindings are not conflicting
- Use the emergency stop keys if needed

* License

GPL-3.0-or-later

* Contributing

Issues and pull requests welcome at: [[https://github.com/0WD0/neoscroll.el]]
